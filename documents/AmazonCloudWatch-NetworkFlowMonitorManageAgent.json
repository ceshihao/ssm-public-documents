{
  "schemaVersion": "2.2",
  "description": "Send commands to Network Flow Monitor agent",
  "parameters": {
    "Action": {
      "type": "String",
      "interpolationType": "ENV_VAR",
      "description": "Command to be executed by Network Flow Monitor agent",
      "default": "Activate",
      "allowedValues": [
        "Activate",
        "Deactivate"
      ]
    }
  },
  "mainSteps": [
    {
      "action": "aws:runShellScript",
      "name": "ExecuteAction",
      "precondition": {
        "StringEquals": [
          "platformType",
          "Linux"
        ]
      },
      "inputs": {
        "runCommand": [
          "if [ -z \"${SSM_Action}\" ]; then",
          "  export SSM_Action=\"{{ Action }}\"",
          "fi",
          "",
          "if [ \"${SSM_Action}\" = \"Activate\" ]; then",
          "  systemctl start network-flow-monitor && echo 'network-flow-monitor activated'",
          "else",
          "  systemctl stop network-flow-monitor && echo 'network-flow-monitor deactivated'",
          "fi"
        ]
      }
    }
  ]
}
