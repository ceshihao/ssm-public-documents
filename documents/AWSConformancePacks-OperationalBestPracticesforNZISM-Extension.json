{
  "schemaVersion": "1.0",
  "description": "Operational Best Practices for NZISM Extension",
  "templateBody": {
    "Parameters": {
      "CheckForAlbWafEnabled": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForApiGwAssociatedWithWaf": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForApiGwCacheEnabledAndEncrypted": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForDynamodbInBackupPlan": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForEbsInBackupPlan": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForEfsInBackupPlan": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForRdsClusterMultiAzEnabled": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForRdsInBackupPlan": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForRdsMultiAzSupport": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForS3BucketVersioningEnabled": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForS3DefaultEncryptionKms": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      },
      "CheckForSnsEncryptedKms": {
        "Default": "false",
        "Type": "String",
        "AllowedValues": [
          "true",
          "false"
        ]
      }
    },
    "Conditions": {
      "checkAlbWafEnabled": {
        "Fn::Equals": [
          {
            "Ref": "CheckForAlbWafEnabled"
          },
          "true"
        ]
      },
      "checkApiGwAssociatedWithWaf": {
        "Fn::Equals": [
          {
            "Ref": "CheckForApiGwAssociatedWithWaf"
          },
          "true"
        ]
      },
      "checkApiGwCacheEnabledAndEncrypted": {
        "Fn::Equals": [
          {
            "Ref": "CheckForApiGwCacheEnabledAndEncrypted"
          },
          "true"
        ]
      },
      "checkDynamodbInBackupPlan": {
        "Fn::Equals": [
          {
            "Ref": "CheckForDynamodbInBackupPlan"
          },
          "true"
        ]
      },
      "checkEbsInBackupPlan": {
        "Fn::Equals": [
          {
            "Ref": "CheckForEbsInBackupPlan"
          },
          "true"
        ]
      },
      "checkEfsInBackupPlan": {
        "Fn::Equals": [
          {
            "Ref": "CheckForEfsInBackupPlan"
          },
          "true"
        ]
      },
      "checkRdsClusterMultiAzEnabled": {
        "Fn::Equals": [
          {
            "Ref": "CheckForRdsClusterMultiAzEnabled"
          },
          "true"
        ]
      },
      "checkRdsInBackupPlan": {
        "Fn::Equals": [
          {
            "Ref": "CheckForRdsInBackupPlan"
          },
          "true"
        ]
      },
      "checkRdsMultiAzSupport": {
        "Fn::Equals": [
          {
            "Ref": "CheckForRdsMultiAzSupport"
          },
          "true"
        ]
      },
      "checkS3BucketVersioningEnabled": {
        "Fn::Equals": [
          {
            "Ref": "CheckForS3BucketVersioningEnabled"
          },
          "true"
        ]
      },
      "checkS3DefaultEncryptionKms": {
        "Fn::Equals": [
          {
            "Ref": "CheckForS3DefaultEncryptionKms"
          },
          "true"
        ]
      },
      "checkSnsEncryptedKms": {
        "Fn::Equals": [
          {
            "Ref": "CheckForSnsEncryptedKms"
          },
          "true"
        ]
      }
    },
    "Resources": {
      "AlbWafEnabled": {
        "Condition": "checkAlbWafEnabled",
        "Controls": [
          "3562",
          "4333",
          "7466"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "alb-waf-enabled",
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::ElasticLoadBalancingV2::LoadBalancer"
            ]
          },
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "ALB_WAF_ENABLED"
          },
          "Description": "MUST 19.1.12.C.01[CID:3562], SHOULD 20.3.7.C.02[CID:4333], MUST 23.4.10.C.01[CID:7466]| Gateway security/Gateways/Configuration of gateways & Data management/Content F..."
        }
      },
      "ApiGwAssociatedWithWaf": {
        "Condition": "checkApiGwAssociatedWithWaf",
        "Controls": [
          "3562",
          "4333",
          "7466"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "api-gw-associated-with-waf",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "API_GW_ASSOCIATED_WITH_WAF"
          },
          "Description": "MUST 19.1.12.C.01[CID:3562], SHOULD 20.3.7.C.02[CID:4333], MUST 23.4.10.C.01[CID:7466]| Gateway security/Gateways/Configuration of gateways & Data management/Content F..."
        }
      },
      "ApiGwCacheEnabledAndEncrypted": {
        "Condition": "checkApiGwCacheEnabledAndEncrypted",
        "Controls": [
          "2082"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "api-gw-cache-enabled-and-encrypted",
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::ApiGateway::Stage"
            ]
          },
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "API_GW_CACHE_ENABLED_AND_ENCRYPTED"
          },
          "Description": "SHOULD 17.1.53.C.04[CID:2082]| Cryptography/Cryptographic Fundamentals/Reducing storage and physical transfer requirements"
        }
      },
      "DynamodbInBackupPlan": {
        "Condition": "checkDynamodbInBackupPlan",
        "Controls": [
          "4849"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-in-backup-plan",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_IN_BACKUP_PLAN"
          },
          "Description": "MUST 22.1.26.C.01[CID:4849]| Enterprise systems security/Cloud Computing/Backup, Recovery Archiving and Data Remanence"
        }
      },
      "EbsInBackupPlan": {
        "Condition": "checkEbsInBackupPlan",
        "Controls": [
          "4849"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "ebs-in-backup-plan",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "EBS_IN_BACKUP_PLAN"
          },
          "Description": "MUST 22.1.26.C.01[CID:4849]| Enterprise systems security/Cloud Computing/Backup, Recovery Archiving and Data Remanence"
        }
      },
      "EfsInBackupPlan": {
        "Condition": "checkEfsInBackupPlan",
        "Controls": [
          "4849"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "efs-in-backup-plan",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "EFS_IN_BACKUP_PLAN"
          },
          "Description": "MUST 22.1.26.C.01[CID:4849]| Enterprise systems security/Cloud Computing/Backup, Recovery Archiving and Data Remanence"
        }
      },
      "RdsClusterMultiAzEnabled": {
        "Condition": "checkRdsClusterMultiAzEnabled",
        "Controls": [
          "4829"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "rds-cluster-multi-az-enabled",
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::RDS::DBCluster"
            ]
          },
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "RDS_CLUSTER_MULTI_AZ_ENABLED"
          },
          "Description": "MUST 22.1.23.C.01[CID:4829]| Enterprise systems security/Cloud Computing/System Availability"
        }
      },
      "RdsInBackupPlan": {
        "Condition": "checkRdsInBackupPlan",
        "Controls": [
          "4849"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "rds-in-backup-plan",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "RDS_IN_BACKUP_PLAN"
          },
          "Description": "MUST 22.1.26.C.01[CID:4849]| Enterprise systems security/Cloud Computing/Backup, Recovery Archiving and Data Remanence"
        }
      },
      "RdsMultiAzSupport": {
        "Condition": "checkRdsMultiAzSupport",
        "Controls": [
          "4829"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "rds-multi-az-support",
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::RDS::DBInstance"
            ]
          },
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "RDS_MULTI_AZ_SUPPORT"
          },
          "Description": "MUST 22.1.23.C.01[CID:4829]| Enterprise systems security/Cloud Computing/System Availability"
        }
      },
      "S3BucketVersioningEnabled": {
        "Condition": "checkS3BucketVersioningEnabled",
        "Controls": [
          "4849"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-bucket-versioning-enabled",
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          },
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_BUCKET_VERSIONING_ENABLED"
          },
          "Description": "MUST 22.1.26.C.01[CID:4849]| Enterprise systems security/Cloud Computing/Backup, Recovery Archiving and Data Remanence"
        }
      },
      "S3DefaultEncryptionKms": {
        "Condition": "checkS3DefaultEncryptionKms",
        "Controls": [
          "2082"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-default-encryption-kms",
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          },
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_DEFAULT_ENCRYPTION_KMS"
          },
          "Description": "SHOULD 17.1.53.C.04[CID:2082]| Cryptography/Cryptographic Fundamentals/Reducing storage and physical transfer requirements"
        }
      },
      "SnsEncryptedKms": {
        "Condition": "checkSnsEncryptedKms",
        "Controls": [
          "4839"
        ],
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "sns-encrypted-kms",
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::SNS::Topic"
            ]
          },
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "SNS_ENCRYPTED_KMS"
          },
          "Description": "SHOULD 22.1.24.C.04[CID:4839]| Enterprise systems security/Cloud Computing/Unauthorised Access"
        }
      }
    }
  }
}
