{
  "description": "AWS Config Compliance Conformance Pack for Cyber Resilience Best Practices for Amazon S3, EBS and DynamoDB",
  "schemaVersion": "1.0",
  "templateBody": {
    "Parameters": {
      "EncryptedVolumesParamKmsId": {
        "Type": "String",
        "Description": "Optional KMS Key ID for EBS encryption compliance rules",
        "Default": ""
      },
      "EbsLastBackupRecoveryPointCreatedParamRecoveryPointAgeValue": {
        "Type": "String",
        "Description": "Maximum number of days allowed since last EBS backup recovery point was created",
        "Default": "1"
      },
      "EbsLastBackupRecoveryPointCreatedParamRecoveryPointAgeUnit": {
        "Type": "String",
        "Description": "Unit of time for maximum allowed age for EBS backups",
        "Default": "days"
      },
      "EbsResourcesInLogicallyAirGappedVaultParamRecoveryPointAgeValue": {
        "Type": "String",
        "Description": "Maximum number of days allowed since last EBS air-gapped backup recovery point",
        "Default": "1"
      },
      "EbsResourcesInLogicallyAirGappedVaultParamRecoveryPointAgeUnit": {
        "Type": "String",
        "Description": "Unit of time for maximum allowed age for EBS air-gapped backups",
        "Default": "days"
      },
      "DynamodbTableEncryptedKmsParamKmsKeyArns": {
        "Type": "String",
        "Description": "Comma separated list of AWS KMS key ARNs allowed for encrypting Amazon DynamoDB Tables",
        "Default": ""
      },
      "DynamodbLastBackupRecoveryPointCreatedParamRecoveryPointAgeValue": {
        "Type": "String",
        "Description": "Maximum number of days allowed since last DynamoDB backup recovery point",
        "Default": "1"
      },
      "DynamodbLastBackupRecoveryPointCreatedParamRecoveryPointAgeUnit": {
        "Type": "String",
        "Description": "Unit of time for maximum allowed age for DynamoDB backups",
        "Default": "days"
      },
      "S3BucketDefaultLockEnabledParamMode": {
        "Type": "String",
        "Description": "S3 Object Lock mode - GOVERNANCE or COMPLIANCE",
        "Default": "GOVERNANCE"
      },
      "BackupPlanMinFrequencyAndMinRetentionCheckParamRequiredFrequencyValue": {
        "Type": "String",
        "Description": "Numerical value for required backup frequency. Maximum of 24 for hours, 31 for days",
        "Default": "1"
      },
      "BackupPlanMinFrequencyAndMinRetentionCheckParamRequiredRetentionDays": {
        "Type": "String",
        "Description": "Required retention period in days",
        "Default": "35"
      },
      "BackupPlanMinFrequencyAndMinRetentionCheckParamRequiredFrequencyUnit": {
        "Type": "String",
        "Description": "Unit of time for required backup frequency",
        "Default": "days"
      },
      "BackupRecoveryPointMinimumRetentionCheckParamRequiredRetentionDays": {
        "Type": "String",
        "Description": "Minimum retention period in days for backup recovery points",
        "Default": "35"
      }
    },
    "Conditions": {
      "HasKmsKeyId": {
        "Fn::Not": [
          {
            "Fn::Equals": [
              {
                "Ref": "EncryptedVolumesParamKmsId"
              },
              ""
            ]
          }
        ]
      },
      "HasDynamodbKmsKeyArns": {
        "Fn::Not": [
          {
            "Fn::Equals": [
              {
                "Ref": "DynamodbTableEncryptedKmsParamKmsKeyArns"
              },
              ""
            ]
          }
        ]
      }
    },
    "Resources": {
      "EncryptedVolumes": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "encrypted-volumes",
          "Description": "Checks whether Amazon Elastic Block Store (Amazon EBS) volumes are encrypted",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "ENCRYPTED_VOLUMES"
          },
          "InputParameters": {
            "kmsId": {
              "Fn::If": [
                "HasKmsKeyId",
                {
                  "Ref": "EncryptedVolumesParamKmsId"
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::EC2::Volume"
            ]
          }
        }
      },
      "EbsLastBackupRecoveryPointCreated": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "ebs-last-backup-recovery-point-created",
          "Description": "Checks if a recovery point was created for Amazon Elastic Block Store (Amazon EBS) volumes within the specified time period",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "EBS_LAST_BACKUP_RECOVERY_POINT_CREATED"
          },
          "InputParameters": {
            "recoveryPointAgeValue": {
              "Ref": "EbsLastBackupRecoveryPointCreatedParamRecoveryPointAgeValue"
            },
            "recoveryPointAgeUnit": {
              "Ref": "EbsLastBackupRecoveryPointCreatedParamRecoveryPointAgeUnit"
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::EC2::Volume"
            ]
          }
        }
      },
      "EbsResourcesInLogicallyAirGappedVault": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "ebs-resources-in-logically-air-gapped-vault",
          "Description": "Checks if Amazon Elastic Block Store (Amazon EBS) volumes are in a logically air-gapped backup vault",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "EBS_RESOURCES_IN_LOGICALLY_AIR_GAPPED_VAULT"
          },
          "InputParameters": {
            "recoveryPointAgeValue": {
              "Ref": "EbsResourcesInLogicallyAirGappedVaultParamRecoveryPointAgeValue"
            },
            "recoveryPointAgeUnit": {
              "Ref": "EbsResourcesInLogicallyAirGappedVaultParamRecoveryPointAgeUnit"
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::EC2::Volume"
            ]
          }
        }
      },
      "EbsResourcesProtectedByBackupPlan": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "ebs-resources-protected-by-backup-plan",
          "Description": "Checks if Amazon Elastic Block Store (Amazon EBS) volumes are protected by a backup plan",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "EBS_RESOURCES_PROTECTED_BY_BACKUP_PLAN"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::EC2::Volume"
            ]
          }
        }
      },
      "DynamodbPitrEnabled": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-pitr-enabled",
          "Description": "Checks if point-in-time recovery (PITR) is enabled for Amazon DynamoDB tables",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_PITR_ENABLED"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::DynamoDB::Table"
            ]
          }
        }
      },
      "DynamodbTableEncryptionEnabled": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-table-encryption-enabled",
          "Description": "Checks if Amazon DynamoDB tables are encrypted",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_TABLE_ENCRYPTION_ENABLED"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::DynamoDB::Table"
            ]
          }
        }
      },
      "DynamodbTableEncryptedKms": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-table-encrypted-kms",
          "Description": "Checks if Amazon DynamoDB tables are encrypted with AWS KMS",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_TABLE_ENCRYPTED_KMS"
          },
          "InputParameters": {
            "kmsKeyArns": {
              "Fn::If": [
                "HasDynamodbKmsKeyArns",
                {
                  "Ref": "DynamodbTableEncryptedKmsParamKmsKeyArns"
                },
                {
                  "Ref": "AWS::NoValue"
                }
              ]
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::DynamoDB::Table"
            ]
          }
        }
      },
      "DynamodbTableDeletionProtectionEnabled": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-table-deletion-protection-enabled",
          "Description": "Checks if Amazon DynamoDB tables have deletion protection enabled",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_TABLE_DELETION_PROTECTION_ENABLED"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::DynamoDB::Table"
            ]
          }
        }
      },
      "DynamodbInBackupPlan": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-in-backup-plan",
          "Description": "Checks if Amazon DynamoDB tables are included in backup plans",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_IN_BACKUP_PLAN"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::DynamoDB::Table"
            ]
          }
        }
      },
      "DynamodbLastBackupRecoveryPointCreated": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-last-backup-recovery-point-created",
          "Description": "Checks if a recovery point was created for Amazon DynamoDB tables within the specified time period",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_LAST_BACKUP_RECOVERY_POINT_CREATED"
          },
          "InputParameters": {
            "recoveryPointAgeValue": {
              "Ref": "DynamodbLastBackupRecoveryPointCreatedParamRecoveryPointAgeValue"
            },
            "recoveryPointAgeUnit": {
              "Ref": "DynamodbLastBackupRecoveryPointCreatedParamRecoveryPointAgeUnit"
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::DynamoDB::Table"
            ]
          }
        }
      },
      "DynamodbResourcesProtectedByBackupPlan": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "dynamodb-resources-protected-by-backup-plan",
          "Description": "Checks if Amazon DynamoDB tables are protected by a backup plan",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "DYNAMODB_RESOURCES_PROTECTED_BY_BACKUP_PLAN"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::DynamoDB::Table"
            ]
          }
        }
      },
      "S3BucketVersioningEnabled": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-bucket-versioning-enabled",
          "Description": "Checks whether versioning is enabled for S3 buckets",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_BUCKET_VERSIONING_ENABLED"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "S3DefaultEncryptionKms": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-default-encryption-kms",
          "Description": "Checks if S3 buckets have default encryption enabled with KMS",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_DEFAULT_ENCRYPTION_KMS"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "S3ResourcesProtectedByBackupPlan": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-resources-protected-by-backup-plan",
          "Description": "Checks if Amazon S3 buckets are protected by a backup plan",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_RESOURCES_PROTECTED_BY_BACKUP_PLAN"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "S3ResourcesInLogicallyAirGappedVault": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-resources-in-logically-air-gapped-vault",
          "Description": "Checks if S3 buckets are in a logically air-gapped vault",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_RESOURCES_IN_LOGICALLY_AIR_GAPPED_VAULT"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "S3BucketServerSideEncryptionEnabled": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-bucket-server-side-encryption-enabled",
          "Description": "Checks if S3 buckets have default encryption enabled",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_BUCKET_SERVER_SIDE_ENCRYPTION_ENABLED"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "S3BucketDefaultLockEnabled": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-bucket-default-lock-enabled",
          "Description": "Checks if the S3 bucket has Object Lock enabled by default",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_BUCKET_DEFAULT_LOCK_ENABLED"
          },
          "InputParameters": {
            "mode": {
              "Ref": "S3BucketDefaultLockEnabledParamMode"
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "S3CrossRegionReplication": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-bucket-cross-region-replication-enabled",
          "Description": "Checks if S3 buckets have cross-region replication enabled",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_BUCKET_REPLICATION_ENABLED"
          },
          "InputParameters": {
            "ReplicationType": "CROSS-REGION"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "S3SameRegionReplication": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "s3-bucket-same-region-replication-enabled",
          "Description": "Checks if S3 buckets have same-region replication enabled",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "S3_BUCKET_REPLICATION_ENABLED"
          },
          "InputParameters": {
            "ReplicationType": "SAME-REGION"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::S3::Bucket"
            ]
          }
        }
      },
      "BackupPlanMinFrequencyAndMinRetentionCheck": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "backup-plan-min-frequency-and-min-retention-check",
          "Description": "Checks if a backup plan has a backup rule that satisfies the required frequency and retention period",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "BACKUP_PLAN_MIN_FREQUENCY_AND_MIN_RETENTION_CHECK"
          },
          "InputParameters": {
            "requiredFrequencyValue": {
              "Ref": "BackupPlanMinFrequencyAndMinRetentionCheckParamRequiredFrequencyValue"
            },
            "requiredRetentionDays": {
              "Ref": "BackupPlanMinFrequencyAndMinRetentionCheckParamRequiredRetentionDays"
            },
            "requiredFrequencyUnit": {
              "Ref": "BackupPlanMinFrequencyAndMinRetentionCheckParamRequiredFrequencyUnit"
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::Backup::BackupPlan"
            ]
          }
        }
      },
      "BackupRecoveryPointEncrypted": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "backup-recovery-point-encrypted",
          "Description": "Checks if backup recovery points are encrypted",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "BACKUP_RECOVERY_POINT_ENCRYPTED"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::Backup::RecoveryPoint"
            ]
          }
        }
      },
      "BackupRecoveryPointManualDeletionDisabled": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "backup-recovery-point-manual-deletion-disabled",
          "Description": "Checks if manual deletion is disabled for backup recovery points",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "BACKUP_RECOVERY_POINT_MANUAL_DELETION_DISABLED"
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::Backup::RecoveryPoint"
            ]
          }
        }
      },
      "BackupRecoveryPointMinimumRetentionCheck": {
        "Type": "AWS::Config::ConfigRule",
        "Properties": {
          "ConfigRuleName": "backup-recovery-point-minimum-retention-check",
          "Description": "Checks if backup recovery points meet minimum retention requirements",
          "Source": {
            "Owner": "AWS",
            "SourceIdentifier": "BACKUP_RECOVERY_POINT_MINIMUM_RETENTION_CHECK"
          },
          "InputParameters": {
            "requiredRetentionDays": {
              "Ref": "BackupRecoveryPointMinimumRetentionCheckParamRequiredRetentionDays"
            }
          },
          "Scope": {
            "ComplianceResourceTypes": [
              "AWS::Backup::RecoveryPoint"
            ]
          }
        }
      }
    }
  }
}
